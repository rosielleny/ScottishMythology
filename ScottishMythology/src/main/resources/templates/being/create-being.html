<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tava</title>
</head>
<body>

    <header>Tava</header>
    
    			<nav>
  <ul>
    <li>
      <a href="/being/beings">Beings</a>
      <ul>
        <li><a href="/being/beings">View</a></li>
        <li><a href="/being/create">Create</a></li>
      </ul>
    </li>
    
    <li>
      <a href="/faction/factions">Factions</a>
      <ul>
        <li><a href="/faction/factions">View</a></li>
        <li><a href="/faction/create">Create</a></li>
      </ul>
    </li>

    <li>
      <a href="/species/species">Species</a>
      <ul>
        <li><a href="/species/species">View</a></li>
        <li><a href="/species/create">Create</a></li>
      </ul>
    </li>

	<li>
      <a href="/ability/abilities">Abilities</a>
      <ul>
        <li><a href="/ability/abilities">View</a></li>
        <li><a href="/ability/create">Create</a></li>
      </ul>
    </li>
    
    <li>
      <a href="/weakness/weaknesses">Weaknesses</a>
      <ul>
        <li><a href="/weakness/weaknesses">View</a></li>
        <li><a href="/weakness/create">Create</a></li>
      </ul>
    </li>
    
    <li>
      <a href="/location/locations">Locations</a>
      <ul>
        <li><a href="/location/locations">View</a></li>
        <li><a href="/location/create">Create</a></li>
      </ul>
    </li>
    
    <li>
      <a href="/symbol/symbolism">Symbolism</a>
      <ul>
        <li><a href="/symbol/symbolism">View</a></li>
        <li><a href="/symbol/create">Create</a></li>
      </ul>
    </li>
    
    <li>
      <a href="/gender/genders">Genders</a>
      <ul>
        <li><a href="/gender/genders">View</a></li>
        <li><a href="/gender/create">Create</a></li>
      </ul>
    </li>

  </ul>
</nav>


	<form th:object="${being}" th:action="@{${entityPath}}" method="post">
		
		<label id="createInput" th:text="${#request.getAttribute('label')}">Label Text:</label>
		<input type="text" th:field="*{beingName}" id="beingNameInput">
		<div id="message"></div>
		<span id="nameValidationError" th:if="${#fields.hasErrors('beingName')}" th:errors="*{entityName}">Cannot be blank</span>
	
		<br><br>
		<label id="createInput" >
			Description:
			<textarea th:field="*{beingDescription}" id="description" maxlength="255" rows="5" cols="40" wrap="soft" required></textarea>
		</label>
		<br><br>
		<label id="createInput" >
			Gender:
			<select th:field="*{beingGender}" id="gender" required>
        		<option th:each="gender : ${genders}" th:value="${gender}" th:text="${gender}"></option>
    		</select>
		</label>
		<br><br>
		<!--Ability has an autofill drop-down list. Abilities are added one at a time
		and added abilities are displayed below-->
		<label id="createInput" >
			Add an ability:
    		<datalist id="abilitiesChoice">
        		<!-- Loops through the abilities list and creates options-->
        		<th:block th:each="ability : ${abilities}">
            		<option th:value="${ability}" th:text="${ability}"></option>
        		</th:block>
    		</datalist>
    <input type="text" id="ajax" list="abilitiesChoice" placeholder="eg. ability">
    <button type="button" id="addButton">Add</button>
    		<br>
    		Abilities:
    		<div id="listToAdd">
    		<ul id="abilitiesList">
    			<li th:each="ability : *{beingAbilities}">
        			<span th:text="${ability}"></span> <button class="remove-button">Remove</button>
    			</li>
			</ul>
			</div>
		</label>
		<br><br>
		
		<button type="submit" id="createButton">Create</button>
	</form>

	<br>
	<br>
	<footer>
		<a href = "/">Home</a>
		<a th:href = "@{${showAllEntityPath}}">Show All</a>
		<a th:href="@{${createEntityPath}}">Create</a>
	</footer>

<script th:inline="javascript">
	
const addButton = document.getElementById('addButton');
const input_2 = document.getElementById('ajax');
const abilitiesList = document.getElementById('abilitiesList');
const abilitiesArray = Array.from(document.querySelectorAll('#abilitiesChoice option')).map(option => option.value);

addButton.addEventListener('click', function() {
    const selectedAbility = input_2.value;

    if (selectedAbility.trim() !== "") {
        // Check if the ability is in the abilitiesArray
        if (!abilitiesArray.includes(selectedAbility)) {
            const isConfirmed = confirm("This ability isn't in the database. Do you want to add it?");
            
            if (isConfirmed) {
                // Send the new ability to the server
                fetch('/ability/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ abilityName: selectedAbility })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // If the ability is successfully saved on the server
                        abilitiesArray.push(selectedAbility);
                        alert('Ability added to the database!');
                    } else {
                        alert('There was an error adding the ability to the database.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('There was an error adding the ability to the database.');
                });
            }
        }

        // Update the abilitiesList on the page
        abilitiesList.innerHTML += '<li>' + selectedAbility + ' <button class="remove-button">Remove</button></li>';
        input_2.value = "";
    }
});

abilitiesList.addEventListener('click', function(event) {
    if (event.target.classList.contains('remove-button')) {
        event.target.parentElement.remove();
    }
});

/* <![CDATA[ */
var entities = /* [[${entities}]] */ [];
/* ]]> */

const input = document.getElementById('entityNameInput');
const submitBtn = document.getElementById('createButton');

input.addEventListener('input', function() {
    const name = this.value;

    if (entities.some(entity => entity.toLowerCase() === name.toLowerCase())) {
        message.textContent = "Already exists.";
        message.style.color = "red";
        submitBtn.disabled = true;
    } else {
        message.textContent = "";
        submitBtn.disabled = false;
    }
});

var dataList = document.getElementById('abilities');
var input2 = document.getElementById('ajax');


</script>
</body>
</html>
